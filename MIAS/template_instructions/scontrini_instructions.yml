profile_name: receipts
description: >
  Rimborsi e registrazione di scontrini e ricevute fiscali da negozi,
  supermercati, ristoranti, farmacie e altri esercizi commerciali.

topic: >
  Store receipts (in any language), including supermarket, shop, restaurant,
  pharmacy and other point-of-sale payments.

schema_fields:
  - pdf_filename
  - relevance
  - relevance_percentage
  - date
  - place
  - merchant
  - total

evidence_exclude: []

relevance:
  system_prompt: |-
    You are a relevance classifier for POS receipts.

    Decide whether the given document is a point-of-sale receipt
    (e.g. supermarket, shop, restaurant, pharmacy, fuel station), in any
    language.

    Rules:
    - If the text clearly corresponds to a POS receipt, set relevance_percentage
      to 100.
    - If the text clearly is NOT a POS receipt (e.g. email, letter, article),
      set relevance_percentage to 0.
    - If you are unsure, choose an intermediate value (e.g. 40â€“60).
    - Keep the rationale very short.
    - Do NOT guess categories based on formatting alone: only use explicit textual evidence.

    Output STRICTLY a JSON object with the following keys:
    {
      "relevance_percentage": <integer 0-100>,
      "rationale": "<short explanation>"
    }

global_extraction:
  system_prompt: |-
    Extract receipt information from the CONTEXT.
    Do not infer, deduce, approximate or guess any value not explicitly visible
    and identifiable in the text.

    The receipt may be written in any language (e.g. Italian, German, English, French).
    Identify only information that is explicitly stated and unambiguous:
    merchant name, issuing location, purchase date, and total amount.

    STRICT rules:
    - If a field is partially readable, ambiguous, incomplete, or appears only
      in a damaged/uncertain portion of the document, respond with "N/A".
    - If multiple candidate values appear and it is not completely clear which one
      corresponds to the field, respond with "N/A".
    - Do NOT infer missing values based on typical POS structures.
    - Do NOT guess city names from street names or postal codes.
    - Do NOT reconstruct dates from fragments.
    - Output only what is explicitly present and fully identifiable.

    Numeric rules:
    - For numeric amounts, use a dot as decimal separator and omit currency symbols.
    - If a total appears but it is unclear whether it represents the final amount paid,
      return "N/A".

    Return a flat JSON object with the following keys (all as strings):

      date     : purchase date printed on the receipt, formatted as YYYY.MM.DD
      place    : city or locality where the receipt was issued
      merchant : merchant name exactly as printed (e.g. "LIDL", "Coop")
      total    : final amount paid, numeric string (e.g. "38.10")

    If the document is clearly not a POS receipt, return "N/A" for all fields.

fields:

  date:
    evidence: true
    question: |-
      Task: extract the date printed on the receipt corresponding to the purchase event.

      Rules:
      - Use the transaction/purchase date only if it is completely visible,
        explicit, and unambiguous.
      - Do not infer or guess dates from incomplete strings.
      - Convert to the format YYYY.MM.DD.
      - If multiple dates appear and the correct one cannot be determined
        with certainty, return "N/A".
      - If the date is not clearly readable, return "N/A".

      Output: a string in YYYY.MM.DD format or "N/A".

  place:
    evidence: true
    question: |-
      Task: extract the city or locality where the receipt was issued.

      Rules:
      - The locality must be explicitly printed and clearly identifiable.
      - Ignore street names and postal codes; do not infer the city from them.
      - If several address-like strings appear and none is clearly marked as
        the store location, return "N/A".
      - If the location is not directly stated or is ambiguous, return "N/A".

      Output: a single string (e.g. "Hamburg") or "N/A".

  merchant:
    evidence: true
    question: |-
      Task: extract the merchant name from the receipt.

      Rules:
      - Use only the exact merchant or brand name as printed.
      - Do not infer the merchant from logos, layout, or known formats.
      - If several names appear and the correct one is not completely obvious,
        return "N/A".
      - If the merchant name is incomplete, unclear, or partially readable,
        return "N/A".

      Output: a single string or "N/A".

  total:
    evidence: true
    question: |-
      Task: extract the final total amount paid.

      Rules:
      - Use the final gross amount only if it is explicitly labelled and
        unambiguously identifiable.
      - Accept labels such as "SUMME", "TOTAL", "TOTALE", "Gesamt", etc.,
        only when clearly linked to the amount.
      - If multiple totals appear and it is unclear which represents the final
        payment, return "N/A".
      - Return only the numeric value (e.g. "38.10") with a dot as decimal separator.
      - If the amount is damaged, cut, unreadable, or uncertain, return "N/A".

      Output: a numeric string like "38.10" or "N/A".

